---
layout: post
title: "机器学习在电商营销派券场景下的应用尝试"
description: "在电商复杂的营销环境下，当人工经验运营遇到瓶颈时，如何运用机器学习辅助运营实现突破？这篇文章介绍了我们团队在这方面所进行的一些尝试"
category: machine learning
tags: [machine learning]
---

这篇文章介绍了在电商复杂的营销环境下，如何借助机器学习建模的能力，降低人工运营的复杂度，提高运营效果。

### 写在前面
最近几年人工智能快速升温，在图像视觉，自然语言处理，游戏AI等领域表现突出，甚至超越人类，但在电商营销领域，还未看到有大规模落地的实际应用案例，而有比较多成功案例的是在线推荐场景。

电商营销，我认为可以分为在线营销和离线营销两大类，比如在线推荐，广告投放等都是在线营销的场景，这些场景主要是考虑**短期目标**，比如转化率，点击率等等，目标非常简单直接，结合目前比较成熟的有监督模型，可以快速落地；相比之下，离线营销则更多是考虑**长期目标**，需要根据目前的业务运营状况，阶段性地制定营销方向和目标，并随着时间推移还可能会不断地进行调整的整体营销策略，需要**全局**把控节奏，这可能是很难让人工智能快速落地的一个原因吧。

另外，在线推荐场景有非常及时的效果反馈，可以非常直接的评价推荐的好坏，同时很容易获得大量的训练样本数据；相比之下，离线营销场景的效果反馈延迟很长，往往是提前开始营销，营销活动持续一段时间，而效果可能无法直接归因到具体的某次营销活动上，容易受到其他因素干扰，需要有设计对照组才可有效的衡量效果。

总结来说，离线营销是一个非常依靠人类经验和智慧进行长期策划的一系列营销活动，所以目前我们从其中已经沉淀相对固化的运营场景着手，逐步建立模型，让机器理解并学习人工运营的经验，完成这些具体场景的营销活动，释放出的人力可以去做更“高级”的事情。

### 从优惠券派券场景出发
优惠券是电商里经常采用的一种营销手段，通过平台/商家让利，给某些用户派发优惠券，刺激用户购买消费，促进新用户转化，老用户留存。所以优惠券的主要作用是提高用户转化率，但是，这是有成本的，包括券的成本，以及短信沟通的成本，所以在评估一次派券活动效果时，不仅仅要看转化率，还要看消耗的成本，ROI。

目前，人工运营的方式，会根据当前的运营数据，分析出需要对哪部分用户群体提高复购留存（往往会结合会员生命周期分阶段运营），再结合预算，制定派券规模及券面额，如果预算有限，则需要筛选出更有“价值”的用户，最后进行派券运营。

所以，第一个阶段，我们的目标是建立一套老客派券转化率预估模型，挑选出派券转化率最高的用户作为更有“价值”的派券用户。

### 派券转化率预估模型（第一版）
根据模型的目标，可以比较容易通过有监督学习进行建模，从以往派券活动的数据中筛选训练样本，模型使用特征主要考虑用户的特征，包括：用户的基础静态特征，比如性别，年龄，地域，注册时间等，用户的行为特征，比如历史购买次数，最近浏览访问行为等，以及用户针对券的一些行为特征，比如查看优惠券次数，优惠券使用占比等特征，将三类用户特征拼接一起，经过一个浅层的NN网络进行训练。

![优惠券派券模型](https://raw.githubusercontent.com/Neway6655/neway6655.github.com/master/images/coupon_model/coupon_nn_model.png)

这里需要额外注意的是样本的构造，挑选的样本需要尽量和营销针对的某个生命周期的老客（比如最近半年没有购买的老客）保持类似，我们的做法是找出历史针对这类老客的全量派券活动，再从中找出当时派券转化的用户和派券后没有转化的用户分别为正样本和负样本。这点非常重要，如果训练使用的样本是一群经常购买的老客人群，模型的预测结果会不准确，这也就是有监督学习里经常强调的训练集和测试集的数据分布需要保持一致。

模型完成后，便可进行线上试验，和人工运营进行对比测试，例如将最近半年未购买的老客随机分成A，B两组，各1000万用户，A组由模型选出500万派券用户，B组由人工筛选500万派券用户。最后评估两组人的转化人数，以及ROI等指标。

对比试验的结果，我们发现A组由模型筛选的500万用户的转化率比人工筛选的要略低。说明模型选的不如人工筛选的好，我们接下来的优化是继续找特征，离线对比之前的模型，有改善，之后，进行了第二轮的试验，这次，模型筛选的人群转化率已经高出人工筛选的人群转化率，但若是从整体1000万用户来看，整体的转化率和人工相差不多，而模型的ROI比较低。进一步的复盘，我们发现模型把本来可能不派券也有很大机会转化的用户也筛了进来，所以导致用券数比较多，ROI偏低，因此需要对模型进一步改进：“挑出最有可能因为派券而转化的人”。

### 派券转化预估模型（第二版）
我们这次将模型的目标定为“挑出最有可能因为派券而转化的人”，如何定义“因为派券而转化”？可能只有上帝才知道吧。我们将这个问题转变了一下: 如果可以找出不派券，也有可能转化的用户，将这部分用户踢除，对剩下的用户再按照第一版模型找出派券转化概率高的用户，这些就是我们需要派券的用户了。

所以这个问题，我们采用两套模型来解决，增加一套自然转化概率预测模型，通过这套模型，我们从大池子中过滤掉最有可能会自然转化的用户，对剩下的用户采用派券转化概率预测模型选出潜在的派券用户。

这里的关键问题，是如何把握到底踢除多少高自然转化概率的用户，踢少了，ROI上不去，踢多了，担心整体转化率会下降。所以我们拿过去几天的数据，对自然转化概率预测模型进行分析:

![覆盖率趋势图](https://raw.githubusercontent.com/Neway6655/neway6655.github.com/master/images/coupon_model/recall_distribution.png)

我们先看看这幅图，横轴代表所有用户按照预测概率从高到低排序后占总人数的百分比，纵轴是覆盖率。从上图我们可以看出若从高分往低分数，大概20%的用户，即可覆盖实际转化人数的70%，所以这张图是一个覆盖率随着预测概率分值变化的趋势图。

接着再看看下面这张：

![PR图](https://raw.githubusercontent.com/Neway6655/neway6655.github.com/master/images/coupon_model/precision_recall.png)

这是典型的Precision-Recall曲线图，从上面我们能看到覆盖率为20%的时候，曲线出现一个明显的拐点，表示随着转化概率分值阀值的变化，当覆盖率达到20%时，可以得到比较好的准确率，若阀值再降低一点，覆盖率可以超过20%，但准确率却会明显下降。

所以结合上面两张图，我们认为覆盖率在20%时的概率分数阀值是一个不错的选择，反推出阀值在0.9附近。于是，我们先从大池子中踢出自然转化概率超过0.9的用户，再在剩下的用户中挑选派券转化概率高的前500万用户，作为最后派券的用户。

经过第三轮的试验，模型和人工相比，整体1000万人群的转化率很接近，但模型的整体ROI要比人工高出不少。这也证实这套方案的可行性，通过将自然高转的用户挪出派券范围，节省了派券的成本，从而提高整体ROI。

所以接下来模型若想同时在转化率和ROI上都超过人工运营，必须再不断优化两套模型，优化的手段仍然是数据+模型：不断丰富样本，添加更多的特征，同时配合特征，对模型做出一些变化，例如采用序列模型，对用户最近行为进行抽象，再融入现有模型中一起训练等。

### 进一步思考和总结
针对优惠券派券的场景，我们可以尝试再往前走一步，比如个性化派券，目前模型只能帮助运营进行选人，至于每个人，派什么券，还是由运营的同学根据经验设定一个统一的券面额和券门槛。所以，下一步的方向，就是研究如何做到针对不同的用户，派发最合适的优惠券，保证ROI的情况下，如何达到更高的转化率。

总结个人的理解，在离线营销场景，目前主要仍然是依靠人工经验为主，模型是辅助配合作用，每个基础的运营场景，都是构建整体营销策略的重要一环，模型需要从各个基础场景做起，实现这些基础场景下的运营价值最大化，通过不断对运营的目标，方式，方法的理解，逐步构建具有宏观调控能力的整体营销策略智能平台。